<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam éŠæˆ²åº«å…±äº«å¹³å°</title>
    
    <!-- React å’Œç›¸é—œä¾è³´ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase å®¢æˆ¶ç«¯ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è‡ªå®šç¾©æ¨£å¼ -->
    <style>
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
        
        body {
            background-color: #111827;
            color: white;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #374151;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #6b7280;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // åœ–ç¤ºçµ„ä»¶
        const Icons = {
          Discord: () => (
            React.createElement('svg', { className: "w-5 h-5", viewBox: "0 0 24 24", fill: "currentColor" },
              React.createElement('path', { d: "M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z" })
            )
          ),
          Steam: () => (
            React.createElement('svg', { className: "w-5 h-5", viewBox: "0 0 24 24", fill: "currentColor" },
              React.createElement('path', { d: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-8h2v6h-2v-6zm0-4h2v2h-2V8z" })
            )
          ),
          Search: () => (
            React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" })
            )
          ),
          Users: () => (
            React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" })
            )
          ),
          GamepadIcon: () => (
            React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" })
            )
          ),
          RefreshCw: ({ className = "w-5 h-5" }) => (
            React.createElement('svg', { className: className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" })
            )
          ),
          ExternalLink: () => (
            React.createElement('svg', { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" })
            )
          ),
          LogOut: () => (
            React.createElement('svg', { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" })
            )
          ),
          Check: () => (
            React.createElement('svg', { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M5 13l4 4L19 7" })
            )
          ),
          Crown: () => (
            React.createElement('svg', { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { d: "M12 6L9 9l3-8 3 8-3-3zM6 9l-3 8h18l-3-8-6 4-6-4z" })
            )
          ),
          X: () => (
            React.createElement('svg', { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" })
            )
          ),
          AlertTriangle: () => (
            React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5l-6.928-12c-.77-.833-2.494-.833-3.464 0l-6.928 12c-.77.833.192 2.5 1.732 2.5z" })
            )
          ),
          Settings: () => (
            React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" }),
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 12a3 3 0 11-6 0 3 3 0 016 0z" })
            )
          )
        };

        // Supabase é…ç½®
        const SUPABASE_CONFIG = {
          url: 'https://lwbrqtevzhfkwbwbcdtz.supabase.co',
          anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3YnJxdGV2emhma3did2JjZHR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0NjcxMjYsImV4cCI6MjA2NzA0MzEyNn0.4s16bos5EEhSuUg-K1Paf8B5UXyo-Ca8reTFZ03VVT8',
          steamApiKey: '274411C2579E7E7CB7482A4BDEAB1077'
        };

        // Steam API å·¥å…·å‡½æ•¸ï¼ˆçœŸå¯¦APIèª¿ç”¨ï¼‰
        const SteamAPI = {
          parseSteamUrl: (url) => {
            const patterns = [
              { pattern: /steamcommunity\.com\/id\/([^/]+)/, type: 'custom_id' },
              { pattern: /steamcommunity\.com\/profiles\/(\d{17})/, type: 'steam_id' }
            ];
            
            for (const { pattern, type } of patterns) {
              const match = url.match(pattern);
              if (match) {
                return {
                  identifier: match[1],
                  type: type,
                  steamId: type === 'steam_id' ? match[1] : null
                };
              }
            }
            return null;
          },

          // çœŸå¯¦çš„ Steam API èª¿ç”¨ - è§£æè‡ªè¨‚IDç‚ºSteam ID
          resolveVanityUrl: async (vanityName) => {
            try {
              const response = await fetch(`https://api.steampowered.com/ISteamUser/ResolveVanityURL/v0001/?key=${SUPABASE_CONFIG.steamApiKey}&vanityurl=${vanityName}`);
              const data = await response.json();
              
              if (data.response && data.response.success === 1) {
                return data.response.steamid;
              }
              return null;
            } catch (error) {
              console.error('è§£æSteamè‡ªè¨‚IDå¤±æ•—:', error);
              return null;
            }
          },

          // çœŸå¯¦çš„ Steam API èª¿ç”¨ - ç²å–ç”¨æˆ¶éŠæˆ²åº«
          getOwnedGames: async (steamId) => {
            try {
              const response = await fetch(`https://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${SUPABASE_CONFIG.steamApiKey}&steamid=${steamId}&format=json&include_appinfo=1`);
              const data = await response.json();
              
              if (data.response && data.response.games) {
                return data.response.games.map(game => ({
                  appid: game.appid,
                  name: game.name,
                  playtime_forever: game.playtime_forever || 0,
                  header_image: `https://cdn.akamai.steamstatic.com/steam/apps/${game.appid}/header.jpg`
                }));
              }
              return [];
            } catch (error) {
              console.error('ç²å–SteaméŠæˆ²åº«å¤±æ•—:', error);
              // ç”±æ–¼CORSé™åˆ¶ï¼Œåœ¨ç€è¦½å™¨ä¸­ç›´æ¥èª¿ç”¨Steam APIå¯èƒ½å¤±æ•—
              // å¯¦éš›éƒ¨ç½²æ™‚æ‡‰è©²é€šéå¾Œç«¯ä»£ç†èª¿ç”¨
              throw new Error('éœ€è¦å¾Œç«¯ä»£ç†ä¾†èª¿ç”¨Steam APIï¼Œé¿å…CORSå•é¡Œ');
            }
          },

          // ç²å–éŠæˆ²è©³ç´°ä¿¡æ¯
          getGameDetails: async (appId) => {
            try {
              const response = await fetch(`https://store.steampowered.com/api/appdetails?appids=${appId}`);
              const data = await response.json();
              
              if (data[appId] && data[appId].success) {
                const gameData = data[appId].data;
                return {
                  name: gameData.name,
                  header_image: gameData.header_image,
                  short_description: gameData.short_description
                };
              }
              return null;
            } catch (error) {
              console.error('ç²å–éŠæˆ²è©³æƒ…å¤±æ•—:', error);
              return null;
            }
          }
        };

        // åˆå§‹åŒ– Supabase
        let supabase;
        try {
          supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
          console.log('âœ… Supabase å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ');
        } catch (error) {
          console.error('âŒ Supabase åˆå§‹åŒ–å¤±æ•—:', error);
        }

        // ä¸»æ‡‰ç”¨çµ„ä»¶
        function App() {
          const [user, setUser] = useState(null);
          const [loading, setLoading] = useState(true);
          const [authLoading, setAuthLoading] = useState(false);
          const [activeTab, setActiveTab] = useState('discover');
          
          const [steamUrl, setSteamUrl] = useState('');
          const [showSteamForm, setShowSteamForm] = useState(false);
          const [syncStatus, setSyncStatus] = useState('');
          const [syncLoading, setSyncLoading] = useState(false);
          
          const [searchTerm, setSearchTerm] = useState('');
          const [filterBy, setFilterBy] = useState('all');
          const [sortBy, setSortBy] = useState('name');
          
          const [users, setUsers] = useState([]);
          const [games, setGames] = useState([]);

          // åˆå§‹åŒ–
          useEffect(() => {
            const initializeApp = async () => {
              try {
                if (supabase) {
                  await initializeAuth();
                  await loadData();
                } else {
                  console.log('Supabase æœªåˆå§‹åŒ–');
                }
              } catch (error) {
                console.error('åˆå§‹åŒ–å¤±æ•—:', error);
              } finally {
                setLoading(false);
              }
            };
            
            initializeApp();
          }, []);

          const initializeAuth = async () => {
            if (!supabase) return;
            
            try {
              const { data: { user } } = await supabase.auth.getUser();
              if (user) {
                await loadUserData(user);
              }
            } catch (error) {
              console.error('èªè­‰åˆå§‹åŒ–å¤±æ•—:', error);
            }

            supabase.auth.onAuthStateChange(async (event, session) => {
              if (event === 'SIGNED_IN' && session?.user) {
                await loadUserData(session.user);
                await loadData();
              } else if (event === 'SIGNED_OUT') {
                setUser(null);
                setActiveTab('discover');
                await loadData();
              }
            });
          };

          const loadUserData = async (authUser) => {
            if (!supabase) return;
            
            setLoading(true);
            try {
              const { data: userData, error } = await supabase
                .from('users')
                .select('*')
                .eq('discord_id', authUser.user_metadata.provider_id)
                .single();

              if (userData) {
                setUser(userData);
                // å¦‚æœç”¨æˆ¶é‚„æ²’æœ‰è¨­ç½®Steamï¼Œé¡¯ç¤ºè¨­ç½®è¡¨å–®
                if (!userData.steam_id) {
                  setShowSteamForm(true);
                }
              } else {
                // å‰µå»ºæ–°ç”¨æˆ¶
                const newUser = {
                  discord_id: authUser.user_metadata.provider_id,
                  username: authUser.user_metadata.full_name || authUser.user_metadata.preferred_username,
                  avatar_url: authUser.user_metadata.avatar_url,
                  is_shared: false
                };

                const { data: createdUser, error: createError } = await supabase
                  .from('users')
                  .insert(newUser)
                  .select()
                  .single();

                if (!createError) {
                  setUser(createdUser);
                  setShowSteamForm(true);
                }
              }
            } catch (error) {
              console.error('è¼‰å…¥ç”¨æˆ¶æ•¸æ“šå¤±æ•—:', error);
            } finally {
              setLoading(false);
            }
          };

          const loadData = async () => {
            if (!supabase) return;
            
            setLoading(true);
            try {
              // è¼‰å…¥ç”¨æˆ¶æ•¸æ“š - æ ¹æ“šç™»å…¥ç‹€æ…‹æ±ºå®šé¡¯ç¤ºç¯„åœ
              const { data: usersData } = await supabase
                .from('users')
                .select('*')
                .order('created_at', { ascending: false });
              
              if (usersData) {
                if (!user) {
                  // ğŸ”’ æœªç™»å…¥ï¼šåªé¡¯ç¤ºå…±äº«å¸³è™Ÿ
                  setUsers(usersData.filter(u => u.is_shared === true));
                } else if (!user.steam_id) {
                  // ğŸ”’ å·²ç™»å…¥ä½†æœªè¨­ç½®Steamï¼šåªé¡¯ç¤ºå…±äº«å¸³è™Ÿ
                  setUsers(usersData.filter(u => u.is_shared === true));
                } else {
                  // âœ… å·²ç™»å…¥ä¸”å·²è¨­ç½®Steamï¼šé¡¯ç¤ºæ‰€æœ‰ç”¨æˆ¶
                  setUsers(usersData);
                }
              }

              // è¼‰å…¥éŠæˆ²æ•¸æ“š - æ ¹æ“šæ¬Šé™æ±ºå®šé¡¯ç¤ºç¯„åœ
              const { data: gamesData } = await supabase
                .from('games')
                .select(`
                  *,
                  user_games (
                    playtime_forever,
                    user:users (username, is_shared)
                  )
                `);
              
              if (gamesData) {
                const formattedGames = gamesData.map(game => {
                  let owners = game.user_games?.map(ug => ug.user?.username).filter(Boolean) || [];
                  const playtime = {};
                  
                  game.user_games?.forEach(ug => {
                    if (ug.user?.username && ug.playtime_forever) {
                      playtime[ug.user.username] = Math.round(ug.playtime_forever / 60);
                    }
                  });

                  if (!user || !user.steam_id) {
                    // ğŸ”’ æœªç™»å…¥æˆ–æœªè¨­ç½®Steamï¼šåªé¡¯ç¤ºå…±äº«å¸³è™Ÿçš„éŠæˆ²
                    const sharedOwners = [];
                    const sharedPlaytime = {};
                    
                    game.user_games?.forEach(ug => {
                      if (ug.user?.is_shared && ug.user?.username) {
                        sharedOwners.push(ug.user.username);
                        if (ug.playtime_forever) {
                          sharedPlaytime[ug.user.username] = Math.round(ug.playtime_forever / 60);
                        }
                      }
                    });
                    
                    if (sharedOwners.length === 0) return null;
                    
                    return {
                      id: game.id,
                      steam_app_id: game.steam_app_id,
                      name: game.name,
                      header_image: game.header_image,
                      owners: sharedOwners,
                      playtime: sharedPlaytime
                    };
                  }

                  // âœ… å·²ç™»å…¥ä¸”å·²è¨­ç½®Steamï¼šé¡¯ç¤ºæ‰€æœ‰éŠæˆ²
                  return {
                    id: game.id,
                    steam_app_id: game.steam_app_id,
                    name: game.name,
                    header_image: game.header_image,
                    owners,
                    playtime
                  };
                }).filter(Boolean);
                
                setGames(formattedGames);
              }
            } catch (error) {
              console.error('è¼‰å…¥æ•¸æ“šå¤±æ•—:', error);
            } finally {
              setLoading(false);
            }
          };

          const signInWithDiscord = async () => {
            if (!supabase) return;
            
            setAuthLoading(true);
            try {
              const { error } = await supabase.auth.signInWithOAuth({
                provider: 'discord',
                options: {
                  redirectTo: window.location.origin
                }
              });
              
              if (error) throw error;
            } catch (error) {
              alert('ç™»å…¥å¤±æ•—: ' + error.message);
            } finally {
              setAuthLoading(false);
            }
          };

          const signOut = async () => {
            if (!supabase) return;
            
            try {
              await supabase.auth.signOut();
            } catch (error) {
              console.error('ç™»å‡ºå¤±æ•—:', error);
            }
          };

          const saveSteamProfile = async () => {
            if (!steamUrl || !supabase || !user) {
              alert('è«‹è¼¸å…¥Steamå€‹äººé é¢é€£çµ');
              return;
            }

            const parsedUrl = SteamAPI.parseSteamUrl(steamUrl);
            if (!parsedUrl) {
              alert('ç„¡æ•ˆçš„Steamé€£çµæ ¼å¼\næ”¯æ´æ ¼å¼:\nâ€¢ https://steamcommunity.com/id/ä½ çš„ID/\nâ€¢ https://steamcommunity.com/profiles/æ•¸å­—ID/');
              return;
            }

            setSyncLoading(true);
            setSyncStatus('è§£æSteamè³‡æ–™ä¸­...');

            try {
              let steamId = parsedUrl.steamId;
              
              // å¦‚æœæ˜¯è‡ªè¨‚IDï¼Œéœ€è¦è§£æç‚ºSteam ID
              if (parsedUrl.type === 'custom_id') {
                setSyncStatus('è§£æè‡ªè¨‚IDä¸­...');
                steamId = await SteamAPI.resolveVanityUrl(parsedUrl.identifier);
                if (!steamId) {
                  alert('ç„¡æ³•è§£æSteamè‡ªè¨‚IDï¼Œè«‹ç¢ºèªIDæ˜¯å¦æ­£ç¢ºæˆ–ç¨å¾Œå†è©¦');
                  return;
                }
              }

              setSyncStatus('åŒæ­¥éŠæˆ²åº«ä¸­...');
              
              try {
                // ğŸ® çœŸå¯¦èª¿ç”¨Steam APIç²å–éŠæˆ²åº«
                const games = await SteamAPI.getOwnedGames(steamId);
                const totalPlaytime = Math.round(games.reduce((total, game) => total + game.playtime_forever, 0) / 60);

                setSyncStatus('å„²å­˜ç”¨æˆ¶è³‡æ–™ä¸­...');

                // æ›´æ–°ç”¨æˆ¶Steamè³‡æ–™
                const { data: updatedUser, error: updateError } = await supabase
                  .from('users')
                  .update({
                    steam_id: steamId,
                    steam_profile_url: steamUrl,
                    game_count: games.length,
                    total_playtime: totalPlaytime
                  })
                  .eq('id', user.id)
                  .select()
                  .single();

                if (updateError) throw updateError;

                setSyncStatus('å„²å­˜éŠæˆ²è³‡æ–™ä¸­...');

                // æ’å…¥éŠæˆ²åˆ°éŠæˆ²è¡¨ä¸¦å»ºç«‹é—œè¯
                for (const game of games) {
                  // å…ˆæ’å…¥æˆ–æ›´æ–°éŠæˆ²
                  const { data: gameData, error: gameError } = await supabase
                    .from('games')
                    .upsert({
                      steam_app_id: game.appid.toString(),
                      name: game.name,
                      header_image: game.header_image
                    }, {
                      onConflict: 'steam_app_id'
                    })
                    .select()
                    .single();

                  if (gameError) {
                    console.log(`æ’å…¥éŠæˆ² ${game.name} å¤±æ•—:`, gameError);
                    continue;
                  }

                  // å»ºç«‹ç”¨æˆ¶éŠæˆ²é—œè¯
                  await supabase
                    .from('user_games')
                    .upsert({
                      user_id: updatedUser.id,
                      game_id: gameData.id,
                      playtime_forever: game.playtime_forever
                    }, {
                      onConflict: 'user_id,game_id'
                    });
                }

                setUser(updatedUser);
                setSyncStatus('åŒæ­¥å®Œæˆï¼');
                
                // é‡æ–°è¼‰å…¥æ•¸æ“šä»¥é¡¯ç¤ºå®Œæ•´å…§å®¹
                await loadData();
                
                alert(`Steamè³‡æ–™åŒæ­¥æˆåŠŸï¼\néŠæˆ²æ•¸é‡: ${games.length}\nç¸½éŠæˆ²æ™‚é–“: ${totalPlaytime} å°æ™‚\n\nç¾åœ¨ä½ å¯ä»¥æŸ¥çœ‹ç¾¤çµ„æ‰€æœ‰æˆå“¡çš„éŠæˆ²åº«äº†ï¼`);
                
                setShowSteamForm(false);
                setSteamUrl('');
                
              } catch (steamError) {
                // Steam APIèª¿ç”¨å¤±æ•—çš„è™•ç†
                console.error('Steam APIèª¿ç”¨å¤±æ•—:', steamError);
                setSyncStatus('Steam APIèª¿ç”¨å¤±æ•—');
                
                if (steamError.message.includes('CORS')) {
                  alert('ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œç„¡æ³•ç›´æ¥èª¿ç”¨Steam APIã€‚\nè«‹è¯ç¹«ç®¡ç†å“¡è¨­ç½®å¾Œç«¯ä»£ç†æœå‹™ï¼Œæˆ–åœ¨å¯¦éš›éƒ¨ç½²ç’°å¢ƒä¸­ä½¿ç”¨ã€‚');
                } else {
                  alert('Steam APIèª¿ç”¨å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦æˆ–æª¢æŸ¥Steamå€‹äººé é¢æ˜¯å¦ç‚ºå…¬é–‹ç‹€æ…‹ã€‚');
                }
              }
              
            } catch (error) {
              console.error('åŒæ­¥Steamè³‡æ–™å¤±æ•—:', error);
              setSyncStatus('åŒæ­¥å¤±æ•—');
              alert('åŒæ­¥å¤±æ•—: ' + error.message);
            } finally {
              setSyncLoading(false);
            }
          };

          const getFilteredGames = () => {
            let filtered = games.filter(game => {
              const matchesSearch = game.name.toLowerCase().includes(searchTerm.toLowerCase());
              
              if (filterBy === 'all') return matchesSearch;
              if (filterBy === 'popular') return matchesSearch && game.owners && game.owners.length >= 2;
              if (filterBy === 'mine' && user) return matchesSearch && game.owners && game.owners.includes(user.username);
              
              return matchesSearch;
            });

            filtered.sort((a, b) => {
              switch (sortBy) {
                case 'name': return a.name.localeCompare(b.name);
                case 'popularity': return (b.owners?.length || 0) - (a.owners?.length || 0);
                case 'playtime':
                  const aPlaytime = Math.max(...Object.values(a.playtime || { default: 0 }));
                  const bPlaytime = Math.max(...Object.values(b.playtime || { default: 0 }));
                  return bPlaytime - aPlaytime;
                default: return 0;
              }
            });

            return filtered;
          };

          const filteredGames = getFilteredGames();

          // æª¢æŸ¥ç”¨æˆ¶æ¬Šé™ç‹€æ…‹
          const hasFullAccess = user && user.steam_id;
          const isLoggedIn = !!user;

          if (loading) {
            return React.createElement('div', { className: "min-h-screen bg-gray-900 text-white flex items-center justify-center" },
              React.createElement('div', { className: "text-center" },
                React.createElement('div', { className: "w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4" }),
                React.createElement('p', { className: "text-gray-400" }, 'è¼‰å…¥ä¸­...')
              )
            );
          }

          return React.createElement('div', { className: "min-h-screen bg-gray-900 text-white" },
            // æ¬Šé™æç¤ºæ©«å¹…
            !hasFullAccess && React.createElement('div', { className: "bg-blue-900 border-b border-blue-700 px-4 py-3" },
              React.createElement('div', { className: "max-w-7xl mx-auto flex items-center justify-between" },
                React.createElement('div', { className: "flex items-center space-x-3" },
                  React.createElement(Icons.AlertTriangle, { className: "w-5 h-5 text-blue-400" }),
                  React.createElement('span', { className: "text-blue-200" },
                    !isLoggedIn 
                      ? 'ç›®å‰åªèƒ½æŸ¥çœ‹å…±äº«å¸³è™Ÿçš„éŠæˆ²åº«ï¼Œç™»å…¥Discordä¸¦é€£çµSteamå¾Œå¯æŸ¥çœ‹ç¾¤çµ„æ‰€æœ‰æˆå“¡çš„éŠæˆ²åº«'
                      : 'è«‹é€£çµä½ çš„Steamå¸³è™Ÿä»¥æŸ¥çœ‹ç¾¤çµ„æ‰€æœ‰æˆå“¡çš„éŠæˆ²åº«'
                  )
                ),
                !isLoggedIn && React.createElement('button', {
                  onClick: signInWithDiscord,
                  className: "bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg text-sm transition-colors"
                }, 'Discord ç™»å…¥'),
                isLoggedIn && !user.steam_id && React.createElement('button', {
                  onClick: () => setShowSteamForm(true),
                  className: "bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm transition-colors"
                }, 'é€£çµ Steam')
              )
            ),

            // é ‚éƒ¨å°èˆª
            React.createElement('div', { className: "bg-gray-800 border-b border-gray-700" },
              React.createElement('div', { className: "max-w-7xl mx-auto px-4 py-4" },
                React.createElement('div', { className: "flex items-center justify-between" },
                  React.createElement('div', { className: "flex items-center space-x-4" },
                    React.createElement('div', { className: "w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center" },
                      React.createElement(Icons.Steam, { className: "w-6 h-6" })
                    ),
                    React.createElement('div', null,
                      React.createElement('h1', { className: "text-xl font-bold" }, 'Steam éŠæˆ²åº«å…±äº«å¹³å°'),
                      React.createElement('p', { className: "text-sm text-gray-400" }, 
                        `${hasFullAccess ? 'ç¾¤çµ„å®Œæ•´éŠæˆ²åº«' : 'å…±äº«å¸³è™ŸéŠæˆ²åº«'} â€¢ ${users.length} ä½${hasFullAccess ? 'ç©å®¶' : 'å…±äº«å¸³è™Ÿ'} â€¢ ${games.length} æ¬¾éŠæˆ²`
                      )
                    )
                  ),
                  React.createElement('div', { className: "flex items-center space-x-4" },
                    user ? [
                      React.createElement('div', { key: 'user-info', className: "flex items-center space-x-3" },
                        React.createElement('img', { 
                          src: user.avatar_url, 
                          alt: user.username, 
                          className: "w-8 h-8 rounded-full" 
                        }),
                        React.createElement('div', { className: "text-right" },
                          React.createElement('div', { className: "text-sm font-medium" }, user.username),
                          React.createElement('div', { className: "text-xs text-gray-400" }, 
                            user.steam_id ? 'å·²é€£çµSteam' : 'æœªé€£çµSteam'
                          )
                        )
                      ),
                      React.createElement('button', { 
                        key: 'logout',
                        onClick: signOut,
                        className: "text-gray-400 hover:text-white p-2 rounded-lg hover:bg-gray-700 transition-colors",
                        title: "ç™»å‡º"
                      }, React.createElement(Icons.LogOut))
                    ] : React.createElement('button', {
                      onClick: signInWithDiscord,
                      disabled: authLoading,
                      className: `bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors ${authLoading ? 'opacity-50' : ''}`
                    },
                      React.createElement(Icons.Discord),
                      React.createElement('span', { className: "text-sm" }, authLoading ? 'ç™»å…¥ä¸­...' : 'Discord ç™»å…¥')
                    )
                  )
                )
              )
            ),

            // ä¸»è¦å…§å®¹
            React.createElement('div', { className: "max-w-7xl mx-auto px-4 py-6" },
              // æ¨™ç±¤é å°èˆª
              React.createElement('div', { className: "flex space-x-1 mb-6 bg-gray-800 p-1 rounded-lg w-fit" },
                React.createElement('button', {
                  onClick: () => setActiveTab('discover'),
                  className: `px-6 py-3 rounded-md transition-colors flex items-center space-x-2 ${activeTab === 'discover' ? 'bg-blue-600 text-white' : 'text-gray-300 hover:text-white hover:bg-gray-700'}`
                },
                  React.createElement(Icons.GamepadIcon),
                  React.createElement('span', null, 'æ¢ç´¢éŠæˆ²')
                ),
                React.createElement('button', {
                  onClick: () => setActiveTab('users'),
                  className: `px-6 py-3 rounded-md transition-colors flex items-center space-x-2 ${activeTab === 'users' ? 'bg-blue-600 text-white' : 'text-gray-300 hover:text-white hover:bg-gray-700'}`
                },
                  React.createElement(Icons.Users),
                  React.createElement('span', null, `${hasFullAccess ? 'ç¾¤çµ„ç©å®¶' : 'å…±äº«å¸³è™Ÿ'} (${users.length})`)
                ),
                user && React.createElement('button', {
                  onClick: () => setActiveTab('profile'),
                  className: `px-6 py-3 rounded-md transition-colors flex items-center space-x-2 ${activeTab === 'profile' ? 'bg-blue-600 text-white' : 'text-gray-300 hover:text-white hover:bg-gray-700'}`
                },
                  React.createElement(Icons.Steam),
                  React.createElement('span', null, 'æˆ‘çš„è³‡æ–™')
                )
              ),

              // éŠæˆ²æ¢ç´¢é é¢
              activeTab === 'discover' && React.createElement('div', null,
                React.createElement('div', { className: "bg-gray-800 rounded-lg p-4 mb-6 border border-gray-700" },
                  React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-4 gap-4" },
                    React.createElement('div', { className: "relative md:col-span-2" },
                      React.createElement(Icons.Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" }),
                      React.createElement('input', {
                        type: "text",
                        placeholder: "æœå°‹éŠæˆ²...",
                        value: searchTerm,
                        onChange: (e) => setSearchTerm(e.target.value),
                        className: "w-full bg-gray-700 border border-gray-600 rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      })
                    ),
                    React.createElement('select', {
                      value: filterBy,
                      onChange: (e) => setFilterBy(e.target.value),
                      className: "bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                    },
                      React.createElement('option', { value: "all" }, 'æ‰€æœ‰éŠæˆ²'),
                      React.createElement('option', { value: "popular" }, 'ç†±é–€éŠæˆ² (2+äººæ“æœ‰)'),
                      hasFullAccess && React.createElement('option', { value: "mine" }, 'æˆ‘çš„éŠæˆ²')
                    ),
                    React.createElement('select', {
                      value: sortBy,
                      onChange: (e) => setSortBy(e.target.value),
                      className: "bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                    },
                      React.createElement('option', { value: "name" }, 'æŒ‰åç¨±æ’åº'),
                      React.createElement('option', { value: "popularity" }, 'æŒ‰å—æ­¡è¿ç¨‹åº¦æ’åº'),
                      React.createElement('option', { value: "playtime" }, 'æŒ‰éŠæˆ²æ™‚é–“æ’åº')
                    )
                  ),
                  React.createElement('div', { className: "mt-4 text-sm text-gray-400" },
                    `é¡¯ç¤º ${filteredGames.length} / ${games.length} æ¬¾éŠæˆ²`,
                    !hasFullAccess && React.createElement('span', { className: "ml-2 text-blue-400" }, '(åƒ…å…±äº«å¸³è™Ÿ)')
                  )
                ),
                
                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
                  filteredGames.map(game => 
                    React.createElement('div', { 
                      key: game.id, 
                      className: "bg-gray-800 rounded-lg overflow-hidden border border-gray-700 hover:border-gray-600 transition-colors" 
                    },
                      React.createElement('img', {
                        src: game.header_image,
                        alt: game.name,
                        className: "w-full h-40 object-cover",
                        onError: (e) => e.target.src = 'https://via.placeholder.com/460x215/374151/9CA3AF?text=Steam+Game'
                      }),
                      React.createElement('div', { className: "p-4" },
                        React.createElement('div', { className: "flex items-start justify-between mb-3" },
                          React.createElement('h3', { className: "text-lg font-semibold line-clamp-2" }, game.name),
                          React.createElement('a', {
                            href: `https://store.steampowered.com/app/${game.steam_app_id}/`,
                            target: "_blank",
                            rel: "noopener noreferrer",
                            className: "text-blue-400 hover:text-blue-300 ml-2"
                          }, React.createElement(Icons.ExternalLink))
                        ),
                        React.createElement('div', { className: "space-y-3" },
                          React.createElement('div', { className: "flex items-center justify-between text-sm" },
                            React.createElement('span', { className: "text-gray-400" }, 'æ“æœ‰è€…:'),
                            React.createElement('span', { className: "text-gray-300" }, `${game.owners?.length || 0} äºº`)
                          ),
                          game.owners && game.owners.length > 0 && React.createElement('div', null,
                            React.createElement('div', { className: "text-sm text-gray-400 mb-2" }, 'ç©å®¶:'),
                            React.createElement('div', { className: "flex flex-wrap gap-1" },
                              game.owners.map(owner =>
                                React.createElement('span', { 
                                  key: owner, 
                                  className: `px-2 py-1 rounded text-xs ${
                                    owner.includes('å…±äº«å¸³è™Ÿ') ? 'bg-blue-600 text-blue-100' : 'bg-green-600 text-green-100'
                                  }` 
                                }, owner)
                              )
                            )
                          ),
                          game.playtime && Object.keys(game.playtime).length > 0 && React.createElement('div', null,
                            React.createElement('div', { className: "text-sm text-gray-400 mb-2" }, 'éŠæˆ²æ™‚é–“:'),
                            React.createElement('div', { className: "space-y-1" },
                              Object.entries(game.playtime).map(([player, hours]) =>
                                React.createElement('div', { 
                                  key: player, 
                                  className: "flex justify-between text-xs" 
                                },
                                  React.createElement('span', { className: "text-gray-300" }, `${player}:`),
                                  React.createElement('span', { className: "text-gray-400" }, `${hours}å°æ™‚`)
                                )
                              )
                            )
                          )
                        )
                      )
                    )
                  )
                ),

                filteredGames.length === 0 && React.createElement('div', { className: "text-center py-12" },
                  React.createElement(Icons.GamepadIcon, { className: "w-16 h-16 text-gray-400 mx-auto mb-4" }),
                  React.createElement('p', { className: "text-gray-400 text-lg" }, 'æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„éŠæˆ²'),
                  !hasFullAccess && React.createElement('p', { className: "text-gray-500 text-sm mt-2" }, 
                    'ç™»å…¥ä¸¦é€£çµSteamå¸³è™Ÿä»¥æŸ¥çœ‹æ›´å¤šéŠæˆ²'
                  )
                )
              ),

              // ç©å®¶åˆ—è¡¨é é¢
              activeTab === 'users' && React.createElement('div', null,
                React.createElement('div', { className: "flex items-center justify-between mb-6" },
                  React.createElement('h2', { className: "text-2xl font-bold" }, 
                    hasFullAccess ? 'ç¾¤çµ„ç©å®¶' : 'å…±äº«å¸³è™Ÿ'
                  ),
                  React.createElement('div', { className: "text-sm text-gray-400" }, 
                    `å…± ${users.length} ä½${hasFullAccess ? 'ç©å®¶' : 'å…±äº«å¸³è™Ÿ'}åŠ å…¥å¹³å°`
                  )
                ),
                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
                  users.map(userData =>
                    React.createElement('div', { 
                      key: userData.id, 
                      className: `rounded-lg p-6 border ${userData.is_shared ? 'bg-blue-900 border-blue-700' : 'bg-gray-800 border-gray-700'}` 
                    },
                      React.createElement('div', { className: "flex items-start space-x-4 mb-4" },
                        React.createElement('div', { className: "relative" },
                          React.createElement('img', {
                            src: userData.avatar_url,
                            alt: userData.username,
                            className: "w-12 h-12 rounded-full"
                          }),
                          userData.is_shared && React.createElement('div', { className: "absolute -top-1 -right-1 bg-blue-500 rounded-full p-1" },
                            React.createElement(Icons.Steam, { className: "w-3 h-3 text-white" })
                          )
                        ),
                        React.createElement('div', { className: "flex-1" },
                          React.createElement('div', { className: "flex items-center space-x-2" },
                            React.createElement('h3', { className: "font-semibold" }, userData.username),
                            userData.is_shared && React.createElement('span', { className: "bg-blue-600 text-blue-100 px-2 py-1 rounded text-xs" }, 'å…±äº«'),
                            userData.id === user?.id && React.createElement('span', { className: "bg-green-600 text-green-100 px-2 py-1 rounded text-xs" }, 'ä½ ')
                          ),
                          React.createElement('p', { className: "text-sm text-gray-400" },
                            userData.is_shared ? 'å…±äº«å¸³è™Ÿ' : `åŠ å…¥æ–¼ ${new Date(userData.created_at).toLocaleDateString()}`
                          )
                        )
                      ),
                      React.createElement('div', { className: "grid grid-cols-2 gap-4 mb-4" },
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-2xl font-bold text-blue-400" }, userData.game_count || 0),
                          React.createElement('div', { className: "text-xs text-gray-400" }, 'éŠæˆ²æ•¸é‡')
                        ),
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-2xl font-bold text-purple-400" }, userData.total_playtime || 0),
                          React.createElement('div', { className: "text-xs text-gray-400" }, 'ç¸½éŠæˆ²æ™‚é–“')
                        )
                      ),
                      userData.steam_profile_url && React.createElement('a', {
                        href: userData.steam_profile_url,
                        target: "_blank",
                        rel: "noopener noreferrer",
                        className: "w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-colors text-sm"
                      },
                        React.createElement(Icons.Steam),
                        React.createElement('span', null, 'æŸ¥çœ‹Steamæª”æ¡ˆ'),
                        React.createElement(Icons.ExternalLink)
                      )
                    )
                  )
                )
              ),

              // å€‹äººè³‡æ–™é é¢
              activeTab === 'profile' && user && React.createElement('div', null,
                React.createElement('div', { className: "flex items-center justify-between mb-6" },
                  React.createElement('h2', { className: "text-2xl font-bold" }, 'æˆ‘çš„è³‡æ–™'),
                  !user.steam_id && React.createElement('button', {
                    onClick: () => setShowSteamForm(true),
                    className: "bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors"
                  },
                    React.createElement(Icons.Steam),
                    React.createElement('span', null, 'é€£çµSteamå¸³è™Ÿ')
                  )
                ),
                React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" },
                  React.createElement('div', { className: "bg-gray-800 rounded-lg p-6 border border-gray-700" },
                    React.createElement('div', { className: "text-center" },
                      React.createElement('img', {
                        src: user.avatar_url,
                        alt: user.username,
                        className: "w-20 h-20 rounded-full mx-auto mb-4"
                      }),
                      React.createElement('h3', { className: "text-xl font-bold mb-2" }, user.username),
                      React.createElement('p', { className: "text-gray-400 text-sm mb-4" }, 'Discord ç”¨æˆ¶'),
                      React.createElement('div', { className: "grid grid-cols-2 gap-4 mb-4" },
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-2xl font-bold text-blue-400" }, user.game_count || 0),
                          React.createElement('div', { className: "text-xs text-gray-400" }, 'éŠæˆ²æ•¸é‡')
                        ),
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-2xl font-bold text-purple-400" }, user.total_playtime || 0),
                          React.createElement('div', { className: "text-xs text-gray-400" }, 'ç¸½éŠæˆ²æ™‚é–“')
                        )
                      ),
                      user.steam_id ? React.createElement('div', { className: "space-y-2" },
                        React.createElement('div', { className: "flex items-center justify-center space-x-2 text-green-400" },
                          React.createElement(Icons.Check),
                          React.createElement('span', { className: "text-sm" }, 'Steam å·²é€£çµ')
                        ),
                        user.steam_profile_url && React.createElement('a', {
                          href: user.steam_profile_url,
                          target: "_blank",
                          rel: "noopener noreferrer",
                          className: "w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-colors text-sm"
                        },
                          React.createElement(Icons.Steam),
                          React.createElement('span', null, 'æŸ¥çœ‹Steamæª”æ¡ˆ'),
                          React.createElement(Icons.ExternalLink)
                        ),
                        React.createElement('button', {
                          onClick: () => setShowSteamForm(true),
                          className: "w-full bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-colors text-sm"
                        },
                          React.createElement(Icons.RefreshCw),
                          React.createElement('span', null, 'é‡æ–°åŒæ­¥')
                        )
                      ) : React.createElement('div', { className: "space-y-3" },
                        React.createElement('div', { className: "bg-yellow-900 border border-yellow-700 rounded-lg p-3" },
                          React.createElement('p', { className: "text-yellow-200 text-sm" }, 'âš ï¸ è«‹é€£çµSteamå¸³è™Ÿä»¥æŸ¥çœ‹ç¾¤çµ„å®Œæ•´éŠæˆ²åº«')
                        ),
                        React.createElement('button', {
                          onClick: () => setShowSteamForm(true),
                          className: "w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-colors"
                        },
                          React.createElement(Icons.Steam),
                          React.createElement('span', null, 'é€£çµSteamå¸³è™Ÿ')
                        )
                      )
                    )
                  ),
                  React.createElement('div', { className: "lg:col-span-2 space-y-6" },
                    React.createElement('div', { className: "bg-gray-800 rounded-lg p-6 border border-gray-700" },
                      React.createElement('h4', { className: "text-lg font-semibold mb-4" }, 'å¹³å°çµ±è¨ˆ'),
                      React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4" },
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-xl font-bold text-blue-400" }, users.length),
                          React.createElement('div', { className: "text-sm text-gray-400" }, hasFullAccess ? 'ç¸½ç©å®¶æ•¸' : 'å…±äº«å¸³è™Ÿ')
                        ),
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-xl font-bold text-purple-400" }, games.length),
                          React.createElement('div', { className: "text-sm text-gray-400" }, 'éŠæˆ²ç¸½æ•¸')
                        ),
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-xl font-bold text-green-400" },
                            games.filter(g => g.owners && g.owners.length >= 2).length
                          ),
                          React.createElement('div', { className: "text-sm text-gray-400" }, 'ç†±é–€éŠæˆ²')
                        ),
                        React.createElement('div', { className: "text-center" },
                          React.createElement('div', { className: "text-xl font-bold text-yellow-400" },
                            hasFullAccess && user ? games.filter(g => g.owners && g.owners.includes(user.username)).length : 0
                          ),
                          React.createElement('div', { className: "text-sm text-gray-400" }, 'æˆ‘çš„éŠæˆ²')
                        )
                      )
                    )
                  )
                )
              )
            ),

            // Steam è¨­å®šå½ˆçª—
            showSteamForm && React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" },
              React.createElement('div', { className: "bg-gray-800 rounded-lg p-6 w-full max-w-md" },
                React.createElement('div', { className: "flex items-center justify-between mb-4" },
                  React.createElement('h3', { className: "text-xl font-bold" }, 'é€£çµ Steam å¸³è™Ÿ'),
                  React.createElement('button', {
                    onClick: () => {
                      setShowSteamForm(false);
                      setSteamUrl('');
                      setSyncStatus('');
                    },
                    className: "text-gray-400 hover:text-white"
                  }, React.createElement(Icons.X))
                ),
                React.createElement('div', { className: "space-y-4" },
                  React.createElement('div', null,
                    React.createElement('label', { className: "block text-sm font-medium mb-2" }, 'Steam å€‹äººé é¢é€£çµ'),
                    React.createElement('input', {
                      type: "url",
                      value: steamUrl,
                      onChange: (e) => setSteamUrl(e.target.value),
                      placeholder: "https://steamcommunity.com/id/ä½ çš„ID/",
                      className: "w-full bg-gray-700 border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    }),
                    React.createElement('div', { className: "mt-2 text-xs text-gray-400" },
                      React.createElement('p', null, 'æ”¯æ´æ ¼å¼ï¼š'),
                      React.createElement('p', null, 'â€¢ https://steamcommunity.com/id/ä½ çš„è‡ªè¨‚ID/'),
                      React.createElement('p', null, 'â€¢ https://steamcommunity.com/profiles/æ•¸å­—ID/'),
                      React.createElement('p', { className: "text-yellow-400 mt-2" }, 'âš ï¸ è«‹ç¢ºä¿ä½ çš„Steamå€‹äººæª”æ¡ˆå’ŒéŠæˆ²è©³æƒ…è¨­ç‚ºå…¬é–‹')
                    )
                  ),
                  syncStatus && React.createElement('div', { 
                    className: `rounded-lg p-3 border ${
                      syncStatus.includes('å®Œæˆ') ? 'bg-green-900 border-green-700' :
                      syncStatus.includes('å¤±æ•—') ? 'bg-red-900 border-red-700' :
                      'bg-blue-900 border-blue-700'
                    }`
                  },
                    React.createElement('p', { 
                      className: `text-sm ${
                        syncStatus.includes('å®Œæˆ') ? 'text-green-300' :
                        syncStatus.includes('å¤±æ•—') ? 'text-red-300' :
                        'text-blue-300'
                      }`
                    }, syncStatus)
                  ),
                  React.createElement('div', { className: "flex space-x-3 pt-4" },
                    React.createElement('button', {
                      onClick: () => {
                        setShowSteamForm(false);
                        setSteamUrl('');
                        setSyncStatus('');
                      },
                      disabled: syncLoading,
                      className: "flex-1 bg-gray-600 hover:bg-gray-700 disabled:opacity-50 py-3 rounded-lg transition-colors"
                    }, 'å–æ¶ˆ'),
                    React.createElement('button', {
                      onClick: saveSteamProfile,
                      disabled: syncLoading || !steamUrl,
                      className: "flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed py-3 rounded-lg transition-colors flex items-center justify-center space-x-2"
                    },
                      syncLoading && React.createElement(Icons.RefreshCw, { className: "w-4 h-4 animate-spin" }),
                      React.createElement('span', null, syncLoading ? 'è™•ç†ä¸­...' : 'é€£çµä¸¦åŒæ­¥')
                    )
                  )
                )
              )
            )
          );
        }

        // æ¸²æŸ“æ‡‰ç”¨
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
